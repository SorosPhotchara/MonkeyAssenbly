@{
    Layout = null;
    ViewData["Title"] = "Home";
}

<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/128/166/166749.png">
    <link rel="stylesheet" href="~/css/home.css">
    <link href="https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        window.HomeUrl = '@ViewBag.HomeUrl';
        window.TagsUrl = '@ViewBag.TagsUrl';
        window.NotifyUrl = '@ViewBag.NotifyUrl';
        window.ProfileUrl = '@ViewBag.ProfileUrl';
        window.LoginUrl = '@ViewBag.LoginUrl';
        window.SignupUrl = '@ViewBag.SignupUrl';
    </script>
</head>

<body>
    <!-- Header -->
    <header class="navbar">
        <div class="logo">
            <a href="@Url.Action("Home", "Home")">
                <img src="/picture/logo.png" alt="Monkey Assemble Logo">
            </a>
        </div>

        <div class="menu">
            <h2 class="active" data-tab="for-you">FOR YOU</h2>
            <h2 data-tab="follow">FOLLOW</h2>
        </div>

        <input type="checkbox" id="toggle">
        <label class="toggle" for="toggle">
            <i class="bx bxs-sun"></i>
            <i class="bx bx-moon"></i>
            <span class="ball"></span>
        </label>
    </header>

    <!-- Sidebar Menu -->
    <nav>
        <div class="sidebar">
            <a href="@Url.Action("Home", "Home")" class="active"><i class="fa-solid fa-home"></i></a>
            <a href="@Url.Action("Tags", "Tags")"><i class="fa-solid fa-tag"></i></a>
            <a href="#" class="add"><i class="fa-solid fa-plus"></i></a>
            <!-- ย้ายไอคอนกระดิ่งมาไว้ตรงนี้ -->
            <a href="@Url.Action("Notify", "Notify")" class="notify-link">
                <i class="fa-solid fa-bell"></i>
                <span class="notify-dot" style="display:none"></span>
            </a>
            <a href="@Url.Action("Profile", "Profile")"><i class="fa-solid fa-user"></i></a>
        </div>
    </nav>

    <!-- Hamburger Menu -->
    <div class="hamburger" id="hamburgerBtn">
        <i class="fa-solid fa-bars"></i>
    </div>

    <div class="hamburger-menu" id="hamburgerMenu">
        <ul id="menuList"></ul>
    </div>

    <!-- Alert Messages -->
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success">
            @TempData["SuccessMessage"]
        </div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger">
            @TempData["ErrorMessage"]
        </div>
    }

    <!-- Popup Create Event -->
    <div id="createEventModal" class="modal">
        <div class="modal-content">
            <i class="fa-solid fa-xmark close-btn"></i>
            <h2>Create Event</h2>
            <form method="post" asp-controller="Post" asp-action="CreatePost">
                @Html.AntiForgeryToken()
                
                <input type="text" name="postTitile" placeholder="event name" required>
                
                <label>วันที่เปิด:</label>
                <input type="date" name="postDateOpen" required>
                
                <label>วันที่ปิด:</label>
                <input type="date" name="postDateClose" required>
                
                <label>เวลาเปิด:</label>
                <input type="time" name="postTimeOpen">
                
                <label>เวลาปิด:</label>
                <input type="time" name="postTimeClose">
                
                <input type="text" name="postPlace" placeholder="location">
                
                <input type="number" name="postMaxPaticipants" placeholder="participants" min="1" required>

                <div class="tag-container">
                    <input type="text" id="tagInput" placeholder="tag">
                    <div id="tagSuggestions" class="suggestions"></div>
                </div>

                <textarea name="postDescript" placeholder="detail"></textarea>

                <p class="note">Check the details of your created event!</p>
                <button type="submit" class="create-btn">Create</button>
            </form>
        </div>
    </div>

    <!-- FEEDS  -->
    <section id="for-you" class="tab-content active"></section>
    <section id="follow" class="tab-content"></section>

    <!-- Event Popup  -->
    <div id="event-popup" class="event-popup hidden">
        <div class="event-popup-content">
            <button id="close-popup" class="popup-close-btn">
                <i class="fa-solid fa-xmark"></i>
            </button>
            
            <h3 id="event-title">Event Name</h3>
            
            <p><strong>Host:</strong> <span id="event-host">HostName</span></p>
            <p><strong>สถานที่:</strong> <span id="event-place">ไม่ระบุ</span></p>

            <h4>ผู้เข้าร่วม</h4>
            <ul id="participants-list">
                <li>Loading...</li>
            </ul>

            <button id="popup-join-btn" class="popup-join-btn">JOIN</button>

            <h4>Comments</h4>
            <div class="comment-section">
                <div id="popup-comment-list"></div>
                <div class="comment-input-wrapper">
                    <input type="text" id="popup-comment-input" placeholder="เขียนความคิดเห็น...">
                    <button id="popup-comment-send">
                        <i class="fa-solid fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/common.js"></script>
    <script src="/js/home.js"></script>
    
    <!-- ป้องกัน double form submission -->
    <script>
    (function() {
        const form = document.querySelector('#createEventModal form');
        if (form) {
            let isSubmitting = false;
            form.addEventListener('submit', function(e) {
                if (isSubmitting) {
                    e.preventDefault();
                    return false;
                }
                isSubmitting = true;
                
                // Reset after 3 seconds in case of error
                setTimeout(() => { isSubmitting = false; }, 3000);
            });
        }
    })();
    </script>
</body>
</html>